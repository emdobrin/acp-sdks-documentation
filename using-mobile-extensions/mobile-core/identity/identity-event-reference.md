# Identity event reference

## Events handled

The following events are handled by the Identity extension:

### Analytics Identity Response

#### Event Details

| Type                          | Source                                 | Paired | Direction                                                    |
| :---------------------------- | :------------------------------------- | :----- | :----------------------------------------------------------- |
| com.adobe.eventType.analytics | com.adobe.eventSource.responseIdentity | True   | This is the end of the paired [Event: v5 Analytics Request Identity](https://wiki.corp.adobe.com/display/ADMSMobile/Event%3A+v5+Analytics+Request+Identity) event containing the AID value |

#### Event Description

This event is a response from the Analytics module that contains the unique tracking identifier. This value may be null if identity module is enabled and there is a valid MID generated.

#### Generators

This event will be generated by:

- calling the Analytics module upon processing the com.adobe.eventSource.requestIdentity event.

#### Event Data Payload Definition

Definition of the key/value pairs that will be present in this event

| Key  | Value Type | Optional | Description                             |
| :--- | :--------- | :------- | :-------------------------------------- |
| aid  | String     | No       | The analytics tracking identifier value |

#### Event Data Example

**sample**

```
`{``    ``"aid" : "aidValue"``}`
```


### Audience Manager Content Response

#### Event Description

This event has 2 purposes:

1. Deliver the Audience Manager profile to the original requester
2. Deliver the Audience Manager profile to any module that may be listening for updates.

This event will be generated in the following scenarios:

- When a request is made to update the Audience manager profile 
- When a request is made to retrieve the current Audience manager profile 

#### Event Details

| Type                                | Source                                | Paired | Direction                                                    |
| :---------------------------------- | :------------------------------------ | :----- | :----------------------------------------------------------- |
| com.adobe.eventType.audienceManager | com.adobe.eventSource.responseContent | True   | This is the response to a paired event. This should be published both with and without a paired ID |

#### Data Payload Definition

Definition of the key/value pairs that will be present in this event

| Key + Key Type         | Value Type | Optional | Description                                                  |
| :--------------------- | :--------- | :------- | :----------------------------------------------------------- |
| <CUSTOMER_KEY>(String) | String     | True     | The Data payload will be full of Customer key value pairs. The Data Payload will be populated using the CV and CN values in the AAM Stuff array |


### Configuration Response Content

#### Event Details

| **Event Type**                    | **Event Source**                      | **Paired** | **Paired Event** |
| :-------------------------------- | :------------------------------------ | :--------- | :--------------- |
| com.adobe.eventType.configuration | com.adobe.eventSource.responseContent | No         | N/A              |

The data property in the Configuration Response Content event is used by each extension to modify its current settings. Each extension is responsible to read out the part of the data property for which it is concerned.

The Identity extension will read the following keys from the configuration event:

Here are the key-value pairs in this event:

| **Key**                  | **Value Type** | **Optional** | **Description**                                              |
| :----------------------- | :------------- | :----------- | :----------------------------------------------------------- |
| `experienceCloud.org`    | String         | Yes          | Experience Cloud Org Identifier                              |
| `experienceCloud.server` | Sting          | Yes          | Custom endpoint to be used for Visitor ID Service network requests |


### Event Hub Shared State

#### Event Description

The shared state event is dispatched by the event hub after a shared state is created or updated. The event data contains the event owner, the name of the module to which the shared state belongs.

#### Event Details

| **Event Type**          | **Event Source**                  | **Paired** | **Paired Event** |
| :---------------------- | :-------------------------------- | :--------- | :--------------- |
| com.adobe.eventType.hub | com.adobe.eventSource.sharedState | No         | N/A              |

#### Data Payload Definition

Definition of the key/value pairs that will be present in this event

| Key        | Value Type | Optional | Description |
| :--------- | :--------- | :------- | :---------- |
| stateOwner | String     | N/A      | N/A         |


### Generic Identity request Identity

#### Event Description

This event is used to set identifiers in the Identity extension and it is generated by:

- Calling the MobileCore \(Android\) / ACPCore \(iOS\) `setAdvertisingIdentifier` API
- Calling the MobileCore \(Android\) / ACPCore \(iOS\)  `setPushIdentifier` API

#### Event details

| **Event Type**                       | **Event Source**                      | **Paired** | **Paired Event** |
| :----------------------------------- | :------------------------------------ | :--------- | :--------------- |
| com.adobe.eventType.generic.identity | com.adobe.eventSource.requestIdentity | No         | N/A              |

#### Data payload definition

Here are the key-value pairs in this event:

| **Key**                 | **Value Type** | **Optional** | **Description**                                              |
| :---------------------- | :------------- | :----------- | :----------------------------------------------------------- |
| `advertisingidentifier` | String         | Yes          | The value of the Advertising Identifier for the mobile device that needs to be set in the SDK. This key is populated when the `setAdvertisingIdentifier` API is called. |
| `pushidentifier`        | String         | Yes          | The value of the Push Identifier that needs to be set. This key is populated when the `setPushIdentifier` API is called. |

#### Event data example 

Set the Advertising Identifier request

```javascript
{
    "advertisingidentifier": "advertisingIdExample"
}
```

#### Event data example 

Set the Push Identifier request

```javascript
{
    "pushidentifier": "pushIdExample"
}
```


### Identity request identity

#### Event Description

This event is used for the Identity extension to complete one of the following tasks::

* To retrieve the custom visitor identifiers
* To retrieve the ECID \(MID\)
* To append the visitor identifiers to an URL
* To synchronize a visitor identifier or a list of identifiers with the ECID service

This event is generated by:

* Calling the Identity `getIdentifiers` API
* Calling the Identity `getExperienceCloudId` API
* Calling the Identity `appendVisitorInfoForURL` \(Android\) / `appendToUrl` \(iOS\) API
* Calling the Identity `getUrlVariables` API
* Calling the Identity `syncIdentifier` or `syncIdentifiers` APIs

#### Event details

| **Event Type** | **Event Source** | **Paired** | **Paired Event** |
| :--- | :--- | :--- | :--- |
| com.adobe.eventType.identity | com.adobe.eventSource.requestIdentity | Yes | [Identity Response Identity event](identity-event-reference.md#identity-response-identity) |

#### Data payload definition

Here are the key-value pairs in this event:

| **Key** | **Value Type** | **Optional** | **Description** |
| :--- | :--- | :--- | :--- |
| `baseurl` | String | Yes | The base URL passed as parameter to the `appendVisitorInfoForURL` \(Android\) / `appendToUrl` \(iOS\) API. |
| `urlvariables` | Boolean | Yes | This key is present in the Identity request event when the `getUrlVariables` API is called. |
| `visitoridentifiers` | Map | Yes | The visitor identifiers that need to be synced with the ECID service. The keys of the map are the identifier types and the values are the associated identifiers. |
| `authenticationstate` | Integer | Yes | The VisitorID Authentication State represent \(Unknown - 0, Authenticated - 1, Logged Out - 2\). |

#### Event data example 

Append to URL request

```javascript
{
    "baseurl": "https://example.com/path?query=parameter1&other=parameter2"
}
```

#### Event data example 

Get URL variables request

```javascript
{
    "urlvariables": true
}
```

#### Event data example 

Sync identifiers request

```javascript
{
    "visitoridentifiers": {
        "idtype1" : "id1",
        "idtype2" : "id2"
    },
    "authenticationstate" : 1
}
```


## Events dispatched

The following events are dispatched by the Identity extension:

### Analytics content request

The Identity extension dispatches a new Analytics Content Request event when a push status preference change is detected, when the push identifier is initially set, or when it is cleared from the SDK. This event is handled by the Analytics extension, and a new internal hit is sent to the Adobe Analytics Server.

For more details about this event see [Analytics Content Request](../../adobe-analytics/analytics-event-reference.md#analytics-content-request)

### Configuration content request

The Identity extension dispatches a new Configuration Content Request event when a privacy change is detected in the response that is received from the ECID Service. This event is handled by the Core extension, and the new privacy status is broadcasted to other extensions.

For more details about this event, see the [Mobile Core](https://app.gitbook.com/@aep-sdks/s/docs/~/drafts/-LzsATEkeUMSPZRDl_O0/using-mobile-extensions/mobile-core) section.

### Identity response identity

This event is a response from the Identity extension to the public API callbacks, and it will be generated in response to an Identity Request Identity event when:

* Retrieving the ECID \(MID\).
* Retrieving the custom visitor identifiers.
* Synchronizing a visitor identifier or a list of identifiers with the ECID Service is complete.
* The result for the append to URL request is ready.

#### Event details

| **Event Type** | **Event Source** | **Paired** | **Paired Event** |
| :--- | :--- | :--- | :--- |
| com.adobe.eventType.identity | com.adobe.eventSource.responseIdentity | Yes | [Identity Request Identity event](identity-event-reference.md#identity-request-identity) |

#### Data payload definition

Here are the key-value pairs in this event:

| **Key** | **Value Type** | **Optional** | **Description** |
| :--- | :--- | :--- | :--- |
| `mid` | String | Yes | The value of the Experience Cloud Identifier \(MID\). |
| `advertisingidentifier` | String | Yes | The value of the Advertising Identifier if it was previously set. |
| `pushidentifier` | String | Yes | The SHA1 hashed Push Identifier if one was previously set. |
| `blob` | String | Yes | The blob value retrieved from the ECID Service. |
| `locationhint` | String | Yes | The location hint value retrieved from the ECID Service. |
| `visitoridslist` | List&gt; | Yes | A list of visitor identifiers that were previously synced using `syncIdentifier` or `syncIdentifiers` public APIs. Each visitor ID will have the following keys: `id_origin`, `id_type`, `id`, `authentication_state`. |
| `lastsync` | Long | Yes | Timestamp in seconds of the last sync call sent to the ECID Service, by default it is 0. |
| `updatedurl` | String | Yes | The update URL when `appendVisitorInfoForURL` \(Android\) / `appendToUrl` \(iOS\) public API is called. |
| `urlvariables` | String | Yes | The Visitor IDs as query parameters string when `getUrlVariables` API is called. |

#### Event data example

When all identifiers, blob and location hint are populated

```javascript
{
    "mid": "midExample",
    "advertisingidentifier": "advertisingIdExample",
    "pushidentifier": "pushIdExample",
    "blob": "blobExample",
    "locationhint": "locationHintExample",
    "visitoridslist": [{
        "id_type": "type1",
        "id_origin": "origin1",
        "id": "id1",
        "authentication_state": 1
    },
    {
        "id_type": "type2",
        "id_origin": "origin2",
        "id": "id2",
        "authentication_state": 2
    }]
}
```

#### Event data example

The result for the `appendToUrl` request:

```javascript
{
    "updatedurl": "https://example.com/path?query=parameter1&other=parameter2&adobe_mc=TS%3D1563845864296%7CMCMID%3Dmidexample%7CMCORGID%3Dorgidexample%40AdobeOrg%7CMCAID%3Daidexample&adobe_aa_vid=videxample"
}
```

#### Event data example

The result for the `getUrlVariables` request:

```javascript
{
    "urlvariables": "adobe_mc=TS%3D1563845864296%7CMCMID%3Dmidexample%7CMCORGID%3Dorgidexample%40AdobeOrg%7CMCAID%3Daidexample&adobe_aa_vid=videxample"
}
```

{% hint style="warning" %}
The Analytics Custom VID is no longer included in the Identity event data payload. If needed, it may be retrieved from the [Analytics extension](https://github.com/Adobe-Marketing-Cloud/aep-sdks-documentation/tree/987092ee0fd2699ae5898755cd72255802628107/using-mobile-extensions/adobe-analytics/analytics-api-reference/README.md#get-the-custom-visitor-identifier).
{% endhint %}


## Shared state

**EXTENSION\_NAME**: `com.adobe.module.identity`

The Identity extension shared state is created in the following situations:

* When the extension first loads and is initialized.
* When handling a sync request, regardless of whether an actual sync occurs.  Occurs when setting the Push Identifier, the Advertising Identifier, or the customer's custom identifiers.
* When the global privacy status changes to `optedout`, a shared state is set after the identifiers are cleared.

| Key | Type | Description |
| :--- | :--- | :--- |
| `mid` | String | MID is a unique ID for that visitor for the given Experience Cloud organization ID. |
| `advertisingidentifier` | String | iOS: the IDFA from retrieved Apple APIs Android: The Advertising Identifier that is returned from Google Play Services. |
| `pushidentifier` | String | The SHA1 hashed Push Identifier. |
| `blob` | String | The blob value returned by the the ECID Service. |
| `locationhint` | String | The ECID Service region ID. A region ID \(or location hint\), is a numeric identifier for the geographic location of a particular ID service data center. |
| `visitoridslist` | List&gt; | The list of all the customer's custom identifiers. |
| `lastsync` | Long | The timestamp of the last  sync with the ECID Service \(in seconds\). The default value 0. |
